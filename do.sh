#!/bin/sh

################################################################################
# Subroutines
################################################################################

warn () {
    echo "$0:" "$@" >&2
}
die () {
    rc=$1
    shift
    warn "$@"
    exit $rc
}
################################################################################


################################################################################
# Change to working directory, delete old files and bring in source data
################################################################################
cd /path/to/ClassCalSync
rm -f *.csv
cp /path/sftp/ClassCalSync_*.csv .
################################################################################


################################################################################
# Load data from Veracross
################################################################################
./classes.pl
./teams.pl
./persons.pl
./enroll.pl
./events.pl
./events-athl.pl
################################################################################


################################################################################
# Find differences in events and enrollment
################################################################################
echo "Finding Updates..."
time ./findUpdates.pl
time ./findUpdates-athl.pl
################################################################################


################################################################################
# Send updates to Google
################################################################################
cd GoogleCalendar
echo
echo "Deleting Events..."
time ./delete_cal_entry.plx 
time ./delete_cal_entry-athl.plx 

echo
echo "Updating Events..."
time ./update_cal_entry.plx 
time ./update_cal_entry-athl.plx 

echo
echo "Creating Events..."
time ./create_cal_entry.plx 
time ./create_cal_entry-athl.plx 
################################################################################
